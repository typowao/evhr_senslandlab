Bootstrap: docker
From: ubuntu:22.04

%help
===========================================================================
        - EVHR (extends -> core) – ILAB dependencies:
===========================================================================

%post
    # update package lists and install required tools
    apt-get update && apt-get install -y \
	python3 \
        python3-pip \
        wget \
        git \
        tar \
        bzip2 \
        ca-certificates \
        build-essential \
        curl

    cd /opt

    # download StereoPipeline
    wget https://github.com/NeoGeographyToolkit/StereoPipeline/releases/download/2.7.0/StereoPipeline-2.7.0-2020-07-29-x86_64-Linux.tar.bz2
    tar --no-same-owner -xf StereoPipeline-2.7.0-2020-07-29-x86_64-Linux.tar.bz2
    rm StereoPipeline-2.7.0-2020-07-29-x86_64-Linux.tar.bz2
    mv StereoPipeline-2.7.0-2020-07-29-x86_64-Linux StereoPipeline

    # install EVHR code
    mkdir -p /usr/local/evhr/scripts
    cp -r scripts/* /usr/local/evhr/scripts/
    chmod a+rwx -R /usr/local/evhr

%environment
    export PATH=/opt/StereoPipeline/bin:$PATH
    export PYTHONPATH=/usr/local/evhr${PYTHONPATH:+:$PYTHONPATH}
